generator client {
  provider = "prisma-client-js"
}

generator tsed {
  provider = "tsed-prisma"
  output   = "./generated"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  /// @TsED.Groups("!creation")
  /// @TsED.Description("User unique identifier")
  id            String     @default(cuid()) @id

  /// @TsED.Email()
  /// @TsED.Description("User email. This email must be unique!")
  email         String  @unique

  name          String?

  role          Role     @default(VIEWER)

  /// @TsED.Description("Hashed user password")
  /// @TsED.Groups("!read")
  password      String?
  avatar        String?

  members       Member[]

  /// @TsED.Groups("!creation")
  /// @TsED.Description("Creation timestamp")
  createdAt     DateTime @default(now())
  /// @TsED.Groups("!creation")
  /// @TsED.Description("Last update timestamp")
  updatedAt     DateTime @updatedAt
}

model Member {
  /// @TsED.Groups("!creation")
  /// @TsED.Description("Member unique identifier")
  id            String   @id @default(cuid())

  userId        String
  organizationId String

  /// @TsED.Description("Role of the member within the organization")
  role          Role     @default(VIEWER)

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  /// @TsED.Groups("!creation")
  /// @TsED.Description("Creation timestamp")
  createdAt     DateTime @default(now())
  /// @TsED.Groups("!creation")
  /// @TsED.Description("Last update timestamp")
  updatedAt     DateTime @updatedAt

  @@unique([userId, organizationId])
}

enum Role {
  ADMIN
  CLIENT
  EDITOR
  SIGNER
  VIEWER
}
